# Отказоустойчивость

Okerr позволяет осуществить схему отказоустойчивости (failover) с использованием резервных серверов, мониторинга okerr и сервисов динамического DNS.

Создать и настроить схему failover можно в разделе "Отказоустойчивость (Динамический DNS)" в настройках проекта.

## Общее описание схемы работы
Каждая схема отказоустойчивости состоит из динамического DNS имени и набора индикаторов. Каждый индикатор в этой схеме соответствует одному из серверов проекта (состояние которого он отображает) с соответствующим серверу приритетом.

При изменении состояния индикаторов okerr выбирает индикатор с наивысшим приоритетом (в состоянии OK и не в состоянии настройки), и через сервис динамического DNS устанавливает значение DNS записи, указывающее на исправный сервер.

Okerr поддерживает DNS сервисы [Hurricane Electric](https://dns.he.net/) и [Cloudflare](https://cloudflare.com). Оба эти сервиса бесплатны. А так же, для тестов и прохождения тренинга можно использовать тестовый аккаунт okerr на cloudflare. Это позволяет не регистрироваться на этих сервисах и просто все сделать из okerr.

## Пример cat.okerr.com
![failover](/_static/failover.png)

Благодаря технологии failover мы поддерживаем [Самый надежный сайт с котиками](https://cat.okerr.com/). По скриншоту выше видно, что схема состоит из трех индикаторов `charlie:cat`, `echo:cat` и `bravo:cat`. Основной сервер - `charlie` (116.202.27.149), его состояние отслеживается индикатором `charlie:cat` (этот индикатор имеет наивысший приоритет).

В момент скриншота видно, что два сервера с наивысшим приоритетом (charlie и echo) находятся в состоянии ERR. Поэтому, okerr активировал последний резервный сервер (bravo). Его IP адрес 37.59.102.26 установлен для динамической записи cat.he.okerr.com (она всегда указывает на работающий сервер с наивысшим приоритетом).

Чтобы следить за тем, как распространяются изменения в правой части отображается:

- Текущее значение DNS записи и ее статус
- Состояние записи, запрошенное с каждого из авторитетных серверов
- Состояние записи, запрошенное через наиболее популярные мировые сервисы DNS
- Последний ответ от сервиса динамического DNS

Для добавления нового резервного сервера, достаточно просто заполнить форму, которая расположена внизу скриншота. Выбрать индикатор, значение IPv4 адреса и желаемый приоритет.

На DNS серверах домена okerr.com имя cat.okerr.com всегда указывает (CNAME) на динамическую запись cat.he.okerr.com (которой управляет okerr), поэтому всегда указывает на живой сервер.